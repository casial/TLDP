<?xml version="1.0"?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.1.2//EN" 
    "http://www.oasis-open.org/docbook/xml/4.1.2/docbookx.dtd" [
<!ENTITY howto         "http://www.tldp.org/HOWTO/">
<!ENTITY mini-howto    "http://www.tldp.org/HOWTO/mini/">
<!ENTITY home          "http://www.catb.org/~esr/">
]>

<article id="index">
<articleinfo>
<title>UPS HOWTO</title>

<authorgroup>
<author>
  <firstname>Eric</firstname>
  <othername>Steven</othername>
  <surname>Raymond</surname>
  <affiliation>
    <orgname><ulink url="&home;">Thyrsus Enterprises</ulink></orgname> 
  </affiliation>
</author>
<author>
  <firstname>Nick </firstname>
  <surname>Christenson</surname>
</author>
</authorgroup>

<revhistory id="revhistory">
   <revision>
      <revnumber>2.2</revnumber>
      <date>2007-05-22</date>
      <authorinitials>esr</authorinitials>
       <revremark>
	 Minor update with more info about battery types.
       </revremark>
   </revision>
   <revision>
      <revnumber>2.1</revnumber>
      <date>2005-09-28</date>
      <authorinitials>esr</authorinitials>
       <revremark>
	 Link fixes.
       </revremark>
   </revision>
   <revision>
      <revnumber>2.0</revnumber>
      <date>2005-08-15</date>
      <authorinitials>esr</authorinitials>
       <revremark>
	 Merged in material by Nick Christenson.
       </revremark>
   </revision>
   <revision>
      <revnumber>1.3</revnumber>
      <date>2005-08-17</date>
      <authorinitials>esr</authorinitials>
       <revremark>
	 Fix a bad link.
       </revremark>
   </revision>
   <revision>
      <revnumber>1.2</revnumber>
      <date>2004-10-28</date>
      <authorinitials>esr</authorinitials>
       <revremark>
	 Remove a bad link.
       </revremark>
   </revision>
   <revision>
      <revnumber>1.1</revnumber>
      <date>2004-02-21</date>
      <authorinitials>esr</authorinitials>
       <revremark>
	 Add a little deployment advice, and stuff on other technologies.
       </revremark>
   </revision>
   <revision>
      <revnumber>1.0</revnumber>
      <date>2003-10-07</date>
      <authorinitials>esr</authorinitials>
       <revremark>
	 Initial release.
       </revremark>
   </revision>
</revhistory>

<abstract><para>
An Uninterruptible Power Supply (UPS) is an important thing to have
if you live in an area where power outages are at all common,
especially if you run a mail/DNS/Web server that must be up 24/7.  This
HOWTO will teach you things you need to know to select a UPS
intelligently and make it work with your open-source operating system.
</para>
</abstract>
</articleinfo>

<sect1 id="introduction"><title>Introduction</title>

<sect2 id="purpose"><title>Why this document?</title>

<para>An Uninterruptible Power Supply (UPS) is an important thing to
have if you live in an area where power outages are at all common,
especially if you run a mail/DNS/Web server that must be up 24/7.  The
aging power grid in the U.S. has made this a more urgent issue than it
used to be even for American hackers, but everyone is vulnerable to
outages caused by storms and other natural phenomena.  This document
covers both the software and hardware aspects of protecting
yourself.</para>

<para>The advice in this document is aimed primarily at small
installations &mdash; one computer and one UPS.  Thus we'll focus on
consumer-grade UPSes, especially those designed for home and
small-business use.  If you are a data center administrator running a
big server farm, there is a whole different (and much more expensive)
range of technologies we'll do no more than hint at here.</para>

<para>The people who contribute to this document can speak only about
equipment they have experience with. This may reflect a bias toward or
against certain brands, features, functions, etc. Please keep in mind that
the suggestions, brand names and functions here are by no means exhaustive,
or even necessarily applicable to your situation. Also, if you have
information that is not in this document, please submit it to the
maintainer listed above. If you submit information, please say whether
you'd like it to be attributed to you or not. We are more than glad to give
credit to the fine people who helped with this document, but we want to
respect the anonymity of those people who would prefer it.</para>

</sect2>

<sect2 id="newversions"><title>New versions of this document</title>

<para>You can also view the latest version of this HOWTO on the World Wide Web
via the URL <ulink url="&howto;UPS-HOWTO.html">
&howto;UPS-HOWTO.html</ulink>.</para>
</sect2>
    
<sect2 id="license"><title>License and Copyright</title>

<para>Copyright (c) 2003,2006 Eric S. Raymond.</para>

<para>Permission is granted to copy, distribute and/or modify this document
      under the terms of the GNU Free Documentation License, Version 1.2
      or any later version published by the Free Software Foundation;
      with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.
      A copy of the license is located at <ulink url="http://www.gnu.org/copyleft/fdl.html">www.gnu.org/copyleft/fdl.html</ulink>.</para>

<para>Feel free to mail any questions or comments about this HOWTO to Eric
S. Raymond, <email>esr@snark.thyrsus.com</email>. But please don't ask me
to troubleshoot your general UPS problems; if you do, I'll just
ignore you.</para>

</sect2>
</sect1>

<sect1><title>An Overview of Power Protection</title>

<para>Power protection guards your equipment against blackouts,
brownouts, surges, and spikes.  All these events are anomalies in the flow 
of mains power that can damage your electronic equipment.</para>

<para>A <emphasis>blackout</emphasis> is a complete interruption of
power; some literature considers a voltage drop below about 80V to be a
blackout as well since most equipment will not operate below that
level.</para>

<para>A <emphasis>dropout</emphasis> is a very short (less than one second)
blackout.</para>

<para>A <emphasis>brownout</emphasis> or <emphasis>sag</emphasis> is a
decrease in voltage levels which can last for periods ranging from
fractions of a second to hours. This can be caused by heavy equipment coming on
line such as shop tools, elevators, compressors etc. Also occurs when
utility companies deliberately do this to cope with peak load times.</para>
 
<para>A <emphasis>spike</emphasis> is a tremendous increase in voltage over
a very short period of time often caused by a direct lightning strike on a
power line or when power returns after a blackout.</para>

<para>A <emphasis>surge</emphasis> is a substantial increase in voltage
lasting a small fraction of a second, often caused when high powered
appliances such as air conditioners are switched off.</para>

<para>There are three levels of power protection available to the
home computer user.  The levels are:</para>

<orderedlist>
<listitem><para>Surge Suppressor</para></listitem>
<listitem><para>Line Conditioners</para></listitem>
<listitem><para>Uninterruptible Power Supplies</para></listitem>
</orderedlist>

<para>While this HOWTO mainly focuses on UPSs, we'll start with some basics
about the other two kinds of power filtering to help you understand where
UPSes fit in.  This is useful even though plummeting UPS prices have made
the low-end alternatives less interesting than they used to be.</para>

<sect2 id="surge"><title>Surge suppressors</title>

<para>These are basically a fancy fuse between the source and your
hardware; they clamp down spikes, but can't fill in a low voltage
level or dropout.</para>

<para>This is a bare minimum level of protection that any piece of
expensive electronics should have.  Note that this applies to more
than just AC power; surge suppressors are available for (and should be
used on) phone lines, and RS-232 and parallel connections (for use on
long lines; generally not needed if the devices are colocated with the
computer and all devices are protected from outside sources).  Note
also that <emphasis>all</emphasis> devices connected to your computer
need to be protected; if you put a surge suppressor on your computer
but not your printer, then a zap on the printer may take out the
computer, too.</para>

<para>An important fact about surge suppressors is that <emphasis>they
need to be replaced if they absorb a large surge</emphasis>.  Besides
fuses, most suppressors rely on on components called Metal-Oxide
Varistors (or MOVs) for spike suppression, which degrade when they
take a voltage hit.  The problem with cheap suppressors is that they
don't tell you when the MOV is cooked, so you can end up with no spike
protection and a false sense of security. Better ones have an
indicator.</para>

<para>You can buy surge suppressors at any Radio Shack; for better prices, go
mail-order through Computer Shopper or some similar magazine.  All of
these are low-cost devices ($10-50).</para>

</sect2>
<sect2 id="conditioners"><title>Line Conditioners</title>

<para>These devices filter noise out of AC lines.  Noise can degrade
your power supply and cause it to fail prematurely.  They also protect
against short voltage dropouts and include surge suppression.</para>

<para>The Tripp-Lite 1200 I used to have was typical of the better class of
line conditioners; a box with a good big soft-iron transformer and a couple
of moby capacitors in it and <emphasis>no</emphasis> conductive path
between the in and out sides.  With one of these, you can laugh at
brownouts and electrical storms.  A fringe benefit is that if you
accidentally pull your plug out of the wall you may find you actually have
time to re-connect it before the machine notices (I did this once).  But a
true UPS is better.</para>

<para>Netter Trey McLendon has good things to say about Zero Surge
conditioners.  He says: "Our systems at work [...]  have been protected for
2.5 years now through many a violent storm...one strike knocked [out] the
MOV-type suppressors on a Mac dealer's training setup across the street
from us.  The Zero Surge just sort of buzzed when the surge came in, with
no interruption whatsoever.  The basic principle is this: ZS units slow
down the surge with a network of passive elements and then sends it back
out the neutral line, which is tied to ground <emphasis>outside at the
box</emphasis> by code.  MOV units shunt the surge to ground <emphasis>at
the computer</emphasis>, where it leaps across serial ports, network
connections, etc. doing its deadly work."</para>

<para>Price vary widely, from $40-400, depending on the power rating
and capabilities of the device.  Mail-order from a reputable supply
house is your best bet.  Line conditioners typically
<emphasis>don't</emphasis> need to be replaced after a surge; check to
see if yours includes MOVs.</para>

</sect2>
<sect2><title>Uninterruptible Power Supplies</title>

<para>The remainder of this document will focus on UPSes. A UPS does three
things for you.  First, it filters the power your machine sees, smoothing
out spikes and voltage fluctuations that can stress or even damage your
electronics.  Secondly, it provides a certain amount of dwell time in the
event your power goes out entirely &mdash; this can often get you through
brownouts and short blackouts. Third, when the UPS is about to run out of
power it can arrange a graceful shutdown of your computer so that no
unpleasant things happen to your disk filesystems.  While the risks of
unexpected shutdown are much lessened in these days of journalling
filesystems like Linux's EXT3 or JFS from what they once were, ensuring a
clean shutdown is still a valuable contribution to any system
administrator's peace of mind.</para>

<para>Here's what a UPS will do for you:</para>

<orderedlist>
<listitem><para>Absorb relatively small power surges.</para></listitem>

<listitem><para>Smooth out noisy power sources.</para></listitem>

<listitem><para>Continue to provide power to equipment during line
sags.</para></listitem>

<listitem><para>Provide power for some time after a blackout has
occurred.</para></listitem>
</orderedlist>

<para>In addition, some UPS or UPS/software combinations provide the
following functions:</para>

<orderedlist>
<listitem><para>
Automatic shutdown of equipment during long power outages.
</para></listitem>

<listitem><para>
Monitoring and logging of the status of the power supply.
</para></listitem>

<listitem><para>
Display the Voltage/Current draw of the equipment.
</para></listitem>

<listitem><para>
Restart equipment after a long power outage.
</para></listitem>

<listitem><para>
Display the voltage currently on the line.
</para></listitem>

<listitem><para>
Provide alarms on certain error conditions.
</para></listitem>

<listitem><para>
Provide alarms on certain error conditions.
</para></listitem>
</orderedlist>

<para>Many pronounce UPS as "ups", but most of the literature seems to
favor "you pee ess", since they use "a UPS" instead of "an UPS". This
document will try to follow the literature. Neither pronunciation will get
you laughed at by those who are experienced in the field.</para>

</sect2>
</sect1>
<sect1><title>UPS Basics</title>

<sect2><title>How To Select A UPS</title>

<para>UPSes are nowadays very inexpensive.  In the U.S. in 2006, quite
capable ones are available for less than $100, and prices are heading
down.  In fact prices are so low now that we're not going to walk you through
the elaborate optimization step that would have been important
even two or three years ago, of estiming the watt dissipation of your
computer and matching it to a UPS rating.  Instead we'll explain
why this would be a waste of effort and how to buy in a simpler
and more effective way.</para>

<warning>
<para>Bear in mind that the UPS systems that you're likely to buy in a
store or computer catalog are <emphasis>not</emphasis> intended for safety
or life-critical equipment. These devices should be considered to be pieces
of consumer electronics. As such, the number-one basis on which most of these
devices compete with each other is on price, not quality.</para>

<para>Cost-effectiveness is more important to UPS vendors (because it
appears to be more important to their customers) than ultimate
reliability. If your life depends on computer uptime, you need a special
purpose, online, big, redundant, expensive system. These systems are beyond
the scope of this document. When you buy a UPS at your local computer
store, you are <emphasis>not</emphasis> buying this sort of system.</para>
</warning>

<para>UPSes are rated by the watts a full battery can put out before
it drains.  However, they are marketed using a VA (voltage-amps)
figure; often, consumer-grade UPSes don't even specify a wattage on
the box where you can see it.  This is because the VA figure is larger
and looks sexier.  As a rule of thumb. assume the wattage is half of
the VA rating; for an explanation of the complexities involved (if you
care) see the white paper <ulink
url='http://sturgeon.apcc.com/whitepapers.nsf/URL/WP-17/$FILE/WP17.pdf'>Understanding
Power Factor, Crest Factor, and Surge Factor</ulink> on the APC
website.</para>

<para>But even if you know the watt rating of the UPS, it is the ratio of
that figure with the wattage dissipation of your computer that
controls the dwell time.  Your dissipation is hard to predict; it can
even be effected by things like the size of monitor you use (big ones
can be quite power-hungry).</para>

<para>Manufacturers try to get around this technical thicket by
putting an expected dwell time on the box.  But they exaggerate and
even lie about their dwell times a lot (this is called
<quote>marketing</quote>).  What they'll do is quote you the dwell
time you would get driving a bare minimum system with the disk drives
shut off and a tiny monitor, in much the same way laptop manufacturers
lie about their battery dwell times.  The more honest UPS
manufacturers give you a little table showing expected dwell times for
different system configurations (<quote>desktop</quote>,
<quote>tower</quote>, etc.). As a rule of thumb, assume you will get
about 50% of the dwell time listed on the box for your configuration
type.</para>

<para>My advice is to forget the numbers game.  Just go online or to
your local computer store and buy one of the higher-end consumer or
home-office models from APC, Best, Tripp-Lite, Belkin, or some other
reputable manufacturer.  Go ahead and grab the model with the longest
dwell time, highest watt rating, or biggest VA number you can find;
the premium for it is not likely to be more than $75 over the
bargain-basement model.  I guarantee you will feel very good about
your decision not to pinch pennies come your first extended power
outage.</para>

<para>Perhaps a more compelling reason it is better to over-buy
capacity rather than ending up with a UPS that is too weak for your
power drain is that overstrained UPSes can fail in ugly ways,
including catching fire and exploding.</para>

<para>Be sure you get a <firstterm>line interactive</firstterm> UPS
rather than the older <firstterm>standby</firstterm> or
<firstterm>SPS</firstterm> type.  The older technology doesn't
actually filter your power through the battery, so you're not assured
of good voltage conditioning.  The main advantage of an SPS (low cost)
has been eroded now that line-interactive UPSes are so inexpensive.
There are other UPS types, but they are either obsolescent or targeted
at large data-center installations.  For a detailed discussion of the
different UPS types, see <ulink
url='http://sturgeon.apcc.com/whitepapers.nsf/URL/WP-1/$FILE/WP1.pdf'>The
different types of UPS systems</ulink>, a white paper on the APC
site.</para>

<para>Another important consideration is how your UPS will communicate
with your computer.  Do not buy a serial line UPS (one that
communicates via an RS-232C cable).  These are passing out of use in
favor of UPS designs that use USB or Ethernet, for the very excellent
reason that RS-232C interfaces are flaky, difficult to configure,
and difficult to debug.  Ethernet is overkill for this application;
UPSes simply don't need that kind of bandwidth.  We recommend sticking 
with USB, which is well-matched in price/performance to this job
and relatively easy to troubleshoot.</para>

<para>Until recently there was an important distinction between
<firstterm>smart</firstterm> and <firstterm>dumb</firstterm> UPSes.
Dumb UPSes did voltage-level signaling through individual pins; smart
ones used the link as a primitive character channel and could pass
more status information over it.  But if you avoid RS232C UPSes you
will never see a dumb one; indeed, it is likely that by the time you
read this no dumb UPses will be in production any longer.</para>

<para>Some UPSes advertise that they deliver a sinusoidal waveform.  Those
that don't may be delivering something more like a square wave or a very
noisy sine wave.  There are differing schools of thought about how
important this is. One school of thought holds that one should always run
equipment on the best approximation of sinusoidal input that one can, and
that deviations produce harmonics which may either be interpreted as signal
if they get through a power supply, or may actually damage the
equipment. Another school holds that since almost all computers use
switching-type power supplies, which only draw power at or near the peaks
of the waveforms, the shape of the input power waveform is not
important.</para>

<para>Who's right? We don't know. Nick's opinion is that sinusoidal output
is worth the extra money, especially for on-line UPS systems that
continually provide their waveform to the computer; Eric is inclined to
doubt it matters much with modern power supplies.  If you don't know that
your equipment has a switching-type power supply, you certainly might want
to think twice before buying a low quality UPS.</para>

<para>Personally, I (Eric) like APC UPSes (nether Eric nor Nick has any
connection with the company).  But this is not the kind of widget for which
manufacturer makes a whole lot of difference as long as you stick with one
of the reputable brands.</para>

</sect2>
<sect2><title>Deploying your UPS and other devices: the total picture</title>

<para>Our recommendation for a production Unix environment is a
configuration like the following:</para>

<orderedlist>
<listitem><para>An UPS for the computer system. </para></listitem>
<listitem><para>Surge suppression on all phone lines, and also on 
serial/parallel lines that leave the room.</para></listitem>
<listitem><para>Line conditioners on any devices not connected to the UPS.  If
you do take a power hit, it's cheaper to replace a $50 line
conditioner than a $1500 laser printer.</para></listitem>
</orderedlist>

<para>If this is too expensive for you, then downgrade the UPS to
a line conditioner like the TrippLite.  But don't go without at least
that.  Running unprotected is false economy, because you
<emphasis>will</emphasis> lose equipment to electrical storms &mdash;
and, Murphy's Law being what it is, you will always get hit at the
worst possible time.</para>

<para>One thing to note is that you typically shouldn't put a laser printer
on the brownout-protected sockets in a UPS &mdash; toner heaters draw
enough current to overload a UPS and cause a shutdown within
seconds. Modern UPSes generally have some plugs that are marked
surge-suppressed but not filtered through the battery; plug your
printer into one of those.</para>

<para>A UPS should be wired directly to (or plugged directly into) the
AC supply (i.e. a surge suppressor is neither required nor suggested
between the wall and the UPS).  In addition, a surge suppressor
between the UPS and the equipment connected to it is redundant.</para>
</sect2>
<sect2><title>Software Assistance</title>

<para>Your UPS communicates with your computer so it can gracefully
shut the computer down when an outage has lasted too long for the
battery to cope.  In order for graceful shutdown to actually happen,
your computer needs to have a background process &mdash; a daemon, in
Unix terms &mdash; watching whatever messages come over the UPS cable
for the one that says <firstterm>terminate</firstterm>. Then it
needs to tell the operating system to shut down.</para>

<para>Your UPS probably comes with a CD full of such software.  Throw
it away, as (a) most of it will be useless bits written for Windows
systems, and (b) in the unlikely event you get Linux software it will
almost certainly be stale binaries for a version you don't run.</para>

<para>Back in the days of dumb serial-line UPses, there used to be
about half a dozen different open-source UPS monitor daemons:
<application>apcd</application>, <application>dumbupsd</application>,
<application>genpowerd</application>.
<application>powerd</application>, <application>smupsd</application>,
<application>usvd</application> and more. These were fairly stupid
programs for a simple job.  Many required you to hand-wire a custom
RS232C cable to get around various evil things that UPS manufacturers
did to their ports in order to lock in customers.</para>

<para>Those days are gone.  USB UPSes get rid of the cable-hacking and
hardware klugery, but require a bit more smarts from a monitor daemon.
Accordingly the field has narrowed considerably.  There appear 
to be only two such projects left standing.</para>

<para>The <ulink url='http://www.networkupstools.org/'>Network UPS
Tools</ulink> project is a generic UPS monitor daemon that aims to
communicate intelligently with all current UPS designs.</para>

<para><ulink url='http://www.apcupsd.org/'>apcupsd</ulink> is a daemon
specifically designed for communicating with UPSes made by APC, the
American Power Corporation.</para>

<para>Both are solid, well-run projects.  Their development groups are
mutually friendly, and there has been occasional talk of a merger.
Awkwardly, the <application>apcupsd</application> project is in many ways
the more featureful of the two, with, among other things, better USB
support and better documentation &mdash; but the NUT tools have a cleaner
architecture, more developers, and acceptance in Red Hat and other major
distributions.</para>

<para>My advice is simple; run <application>apcupsd</application> if
you buy an APC UPS, and the NUT tools if you buy anything else.  RPMs
and Debian packages (which will modify your system's boot sequence
appropriately as well as installing the daemon binaries) are available
for both, so installation should be easy either way.</para>

</sect2>
<sect2><title>Preparing Your System For Auto-Reboot</title>

<para>If you are using your UPS to try to keep a DNS/Web/mailserver up
24/7, you will want to make sure the machine can be configured to
boot automatically when it is powered up.</para>

<para>This is not the normal behavior of most computers as shipped
from the factory. Normally after the power is cut and restored, you
must explicitly press a button for the power to actually be turned
on. You can test your computer by powering it down; shutting off the
power (pull the plug); then plugging the cord back in. If your
computer immediately starts up, good. There is nothing more to
do.</para>

<para>If your computer does not start up, manually turn on the
power (by pressing the power on button) and enter your computer's
SETUP program (often by pressing DEL during the power up sequence;
sometimes by pressing F10). You must then find and change the
appropriate configuration parameter to permit instant power
on.</para>

<para>Normally, this is located under the <emphasis
role="bold">BOOT</emphasis> menu item, and will be called something
such as <emphasis role="bold">Restore on AC/Power Loss</emphasis> or
<emphasis role="bold">Full-On</emphasis>. The exact words will vary
according to the ROM BIOS provider. Generally you will have three
options: <emphasis role="bold">Last State</emphasis>, <emphasis
role="bold">Power On</emphasis>, and <emphasis role="bold">Power
Off</emphasis>.</para>

<para>Some BIOSes do not support such an option.  This is idiotically
bad design, but it does happen.  If so, your only practical remedy is 
to get a new motherboard.</para>

</sect2>
</sect1>
<sect1 id='testing'><title>Testing Your UPS</title>

<para>To test your UPS, throw the circuit breaker with the UPS on it to
simulate and outage and see how the transition goes. Note that in general
testing an UPS by pulling the plug from the wall is not a good
idea. Electronics like to always have a good ground reference. If you
unplug a UPS, it's still powered but now has what electricians call a
"floating ground". Not only can this be bad for electronics, but it can be
quite dangerous as well. It is likely that unplugging just about any UPS
for a short amount of time isn't likely to result in disaster (don't take
our word for it, though!), but in all cases, throwing a circuit breaker
would be a better thing to do.</para>

<para>It might be useful to install a GFI (Ground Fault Interrupter) on your
UPS-covered outlets to facilitate this testing without having to throw a
breaker, especially if you don't have your UPS protected machines on an
isolated circuit (which you probably should). These are the sockets found
in most modern kitchens and bathrooms with a red and a black button. You
push the latter to cut power and the former to restore power.</para>

</sect1>
<sect1 id='maintaining'><title>Maintaining Your UPS</title>

<para>Make sure the UPS keeps in contact with its electrical ground at all
times.  Don't overload it.  If it shows signs of misbehavior or
malfunction, yank it until it's repaired, or replace it.</para>

<para>Your UPS has a battery inside it.  Usually it is a lead-acid
type (those are the least expensive for the manufacturer), but both 
lithium and gel-cel batteries are sometimes used.</para>

<para>The battery is by far the most vulnerable and failure-prone part
of your UPS.  If you have your UPS long enough, you will probably have
battery problems.  Once every six months to a year or so you should
recalibrate your UPS's battery sensor, and once every several years
you will have to replace the batteries.</para>

<sect2><title>Service contracts</title>

<para>Some consumer-grade UPSes, and all UPSes designed for serious
data-center use, can be bought with vendor service contracts.  These don't
make sense for low-end units that can be replaced cheaply from a local
electronics store.  If you're an IT shop with a bunch of UPSes scattered
over a campus, a service contract might make sense, depending on circumstances.
If you have a larger UPS in the 5-10 KVA range, a service contract may be a 
valuable hedge against extended downtime.</para>

</sect2>
<sect2><title>Extending battery life</title>

<para>To extend your battery life, (a) avoid deep discharges, and (b)
don't expose them to extremes of heat, cold, or humidity.
Unfortunately there is not much you can do to avoid deep-discharging
your UPS other than living in an area where power outages are few
and short.</para> 

</sect2>
<sect2><title>Recalibrating Your UPS</title>

<para>Your UPS's dwell-time calibration will lose accuracy over the life
of the battery. The usual symptom of this problem is that the UPS
overestimates the dwell time it has remaining during outages, but
occasionally it can also lead to an actual bad-battery condition going 
undetected and very odd symptoms as a result.</para>

<para>UPSes have a recalibration procedure built into their firmware.
It generally involves deep-discharching and recharging the battery
while the UPS is in a special test mode.  Your recipe for triggering 
such a recalibration will vary according to your UPS software.</para>

<para>You always need to do this when you install new batteries (see
below).  It is a good idea to do it once every six to twelve months 
as routine maintenance, but no more often than that; as we noted
previously, deep discharges shorten your battery life.</para>
</sect2>

<sect2><title>Replacing Your Batteries</title>

<para>All modern UPSes have a low-battery alarm and run a periodic
self-test; they will alert you when replacement is needed. Usually
they both flash an indicator and make an alarm sound.  If you have a
monitoring daemon set up, they will alert it and you will probably get
warning mail.  If you ignore the alarm it will time out, but be
repeated at intervals.</para>

<para>You will occasionally get a false alarm. It's a good idea, if you
get an alarm, to explicitly trigger a UPS self-test the next day and see if
the alarm goes away (the procedure for doing this varies depending on
your UPS software). If the alarm is persistent, you need to replace
the batteries.</para>

<para>It has been reported that bad batteries can also produce symptoms
that mimic inverter failures or wonky control electronics.  Even if
your UPS is displaying epileptic symptoms like repeating alarms and
flashing panel lights, a bad battery is the first thing to
suspect.</para>

<para>UPS manufacturers would of course prefer that you replace your
entire UPS when the batteries die, since they make more money that
way.  But in fact there is nothing unique or magic about UPS batteries.
They are standard types also used for other applications such as
powering marine electronics, with standard connectors.  You can buy
them from sources other than the UPS manufacturer, and sometimes replace
them with equivalents that are better and less expensive.</para>

<para>It's best to wait until the low battery alarm before ordering a
replacement; keeping batteries on the shelf reduces their life unless
you keep them fully charged.</para>

<para>Do not throw old batteries in your regular trash!  They contain
toxic metals and acids.  Be kind to your environment and hand them to
a qualified party for recycling.  Most battery dealers will cheerfully
do this for you.  If not, your local garbage company or waste-disposal
authority can explain to you how and where to turn them in
safely.</para>

<para>Many UPS models use gel-cel batteries in standard formats like 12.0
V, 7.2Ah (151x64x94 mm).  Warning: Many manufactors sell two or three
different types: standard use, cyclic use and high-current use.  UPSes
require high-current and some UPS don't work well with batteries for
standard use, because the voltage goes low too early under high load (the
UPS turns off too fast or the output voltage drops so that the computer
turns off). Standard batteries are for alarm devices, emergency lights or
things like that.  For instance Panasonic sells the "LCR127R2PG1"
(standard), and "UPRW1245P1" (high current), Fiamm the "FG20271" (standard)
and "FGH20902" (high current), CSB the "GP1272" (standard) and "HR 1234W"
(high current).</para>

<para>Below, you will find some suggestions for buying replacement
batteries. One <emphasis>important</emphasis> note of caution: at
least one user purchased one of the aftermarket batteries noted below
and found out that they would not fit into his unit. This required
cutting and soldering and other very undesirable things, so be
extremely careful in measuring your batteries &mdash; including every
millimeter of the terminal connections, which can cause
problems.</para>

<para>Although you can do a hot swap of your batteries while the
computer is running, it may not be very satisfactory, because the unit
will not know that the batteries have been swapped and your monitor
daemon will continue to show a low-battery indication. To correct
this situation, you must do a discharge and recharge of the
battery. At that point the battery should be calibrated better.</para>

<para>It may take several discharges and recharges of new batteries
before they reach full capacity and the dwell-time calibration is
accurate. If your UPS contains two or more battery units and your
monitoring software reports separate voltage levels for them, one way 
to tell is to watch the divergence in voltage levels.  As the cells
reach nominal full capacity, their voltages should converge.</para>

</sect2>
<sect2><title>Buying Batteries</title>

<para>APC makes &quot;Replacement Battery Units&quot; for each of the
SmartUPS models, but they sell them directly only in the U.S.  Your
local Yamaha SeaDoo shop (if you have one) carries 35 ampere-hour deep
cycle marine batteries that are direct replacements for the kind APC
uses in many of its models. These are gel-cel and will double the
runtime and/or cut your recharge time in half.  Here are some West
Coast sources:</para>

<programlisting>
Jet Works
1587 Monrovia Ave.
Newport Beach CA 9266?
Tel: +1 714 548-5259

J-W Batteries, Inc.
Tel: +1 714 548-4017

WPS 49-1200
GEL-CELL KB-35 BATTERY
</programlisting>

<para>The company I've heard most strongly recommended (by Carl
Erhorn, a core developer on the <application>apcupsd</application>
project) is called Battery Wholesale Distributors of Georgetown,
Texas. If you have questions, you can reach them by phone at (800)
365-8444, 9:00AM to 5:00PM (their local time), Monday through
Friday. Carl reports having gotten email from them on the weekends,
although the office is not open then.</para>

<para>The web site, with current pricing, is <ulink
url="http://www.batterywholesale.com">www.batterywholesale.com</ulink>.
They will ship outside of the US, they take all the usual credit
cards, and they accept orders by phone or Web.</para>

<para>Carl reports that BWD has found manufacturers who make batteries
in the standard case sizes, but have additional capacity over original
UPS batteries. Often, the difference is as much as 15% or so, and this
can result in additional runtime. It's a nice upgrade for a minor
increase in price.</para>

<para>BWD is also 'green-aware', in that they encourage you to
recycle your old batteries, and will accept the old batteries back
from you if you cannot find a local place that recycles them. You
pay the shipping  but other than that, there is no charge.</para>

<para>Carl says <quote>I've been very pleased with their
products, service, and pricing. I hope you find them as helpful to
you as I do. I've been dealing with them since about 1994, and have
never been disappointed. The owner of the place also is very good
on technical issues, so if you have questions on their products, he
can get as technical as you need to go.</quote></para>
</sect2>
</sect1>

<sect1><title>Vendor information</title>

<para>Note: Many of these manufacturers make specialty systems for
large data centers, not the consumer-grade UPSes that we cover in
most of the rest of this document.</para>

<variablelist>
<varlistentry>
<term><ulink url="http://www.apcc.com/">American Power Conversion</ulink></term>
<listitem><para>
	APC is the largest manufacturer of small UPSes (&lt;2000 VA)
	and has a whole line
	of UPS systems (mostly line interactive), software, and 
	power system accessories which can be purchased directly 
	from them or via many retail
	outlets around the United States and overseas.
</para></listitem>
</varlistentry>
<varlistentry>
<term><ulink url="http://www.belkin.com/index.asp">Belkin</ulink></term>
<listitem><para>
	Belkin makes a lot of computer connectivity products,
	including UPSes. 
</para></listitem>
</varlistentry>
<varlistentry>
<term><ulink url="http://www.clary.com">Clary Corporation</ulink></term>
<listitem><para>
	Clary sells UPS products and specializes in emergency,
	military, and life support systems.  They also sell
	management software and accessories.  
</para></listitem>
</varlistentry>
<varlistentry>
<term><ulink url="http://www.controlledpwr.com/">Controlled Power Company</ulink></term>
<listitem><para>
	Controlled Power produces UPS systems, power conditioners,
	voltage regulators and transformers.  Equipment can be
	ordered direct.
</para></listitem>
</varlistentry>
<varlistentry>
<term><ulink url="http://www.powerware.com/USA/default.asp">Eaton Powerware</ulink></term>
<listitem><para>
	Eaton Powerware includes the product line that was formerly
	Best Power, Inc..  They produce many types of UPS systems.
	more advanced line interactive systems, and ferroresonant
	line interactive systems as well as software, PDUs, and
	power system accessories.  
</para></listitem>
</varlistentry>
<varlistentry>
<term><ulink url="http://www.gotoemerson.com/main/default.asp">Emerson Electronics</ulink></term>
<listitem><para>	
	Emerson is a big electronics conglomerate.  Its claim to
	fame in the UPS world is that it's the parent company to Liebert.
</para></listitem>
</varlistentry>
<varlistentry>
<term><ulink url="http://www.powersource.net/">Energy Technologies, Inc.</ulink></term>
<listitem><para>
	Energy Technologies provides power devices (including UPSes)
	for physically demanding customers, including military and 
	vehicle uses.  Most if their UPS systems seem to fall in
	the 600 to 6000 VA range.
</para></listitem>
</varlistentry>
<varlistentry>
<term><ulink url="http://www.exide.com">Exide Electronics</ulink></term>
<listitem><para>
	One of the bigger players in the data center sized UPS
	system industry, Exide also makes more modest sized
	on-line and line interactive systems.  Exide products
	can be purchased direct or from their distributors.
</para></listitem>
</varlistentry>
<varlistentry>
<term><ulink url="http://www.gamatronic.com/">Gamatronic Electronic Industris, Ltd.</ulink></term>
<listitem><para>
	We're told these guys are the largest UPS manufacturer
	in Israel and the Middle East.  Their product line runs
	the gammut from 1000 VA to 150 kVA systems.
</para></listitem>
</varlistentry>
<varlistentry>
<term><ulink url="http://www.geindustrial.com/industrialsystems/gede/index.html">General Electric Industrial Systems</ulink></term>
<listitem><para>
	Yup, GE makes UPSes from 300 VA up to MVA systems.
</para></listitem>
</varlistentry>
<varlistentry>
<term><ulink url="http://www.intellipower.com">IntelliPower, Inc.</ulink></term>
<listitem><para>	
	Intellipower sells on-line UPS systems and management software.  
</para></listitem>
</varlistentry>
<varlistentry>
<term><ulink url="http://www.liebert.com/">Liebert</ulink></term>
<listitem><para>
	A subsidiary of Emerson Electronics (see above), Liebert
	is probably the largest manufacturer of large (10 kVA +)
	UPS systems.  Also well known for their other data center
	products including power distribution units and HVAC 
	products.  They also make smaller UPS systems (300 VA on
	up), but these are not nearly as popular.  
</para></listitem>
</varlistentry>
<varlistentry>
<term><ulink url="http://www.mgeups.com">MGE UPS Systems</ulink></term>
<listitem><para>
	MGE UPS Systems sells UPS systems from 300 VA to the very
	large and additional power equipment.
</para></listitem>
</varlistentry>
<varlistentry>
<term><ulink url="http://www.meau.com/eprise/main/Home/home">Mitsubishi Electric Automation</ulink></term>
<listitem><para>
	Mitsubishi Electric Automation seems to specialize in 
	larger (> 5 kVA) UPSes, but they make them as small as
	1 kVA.
</para></listitem>
</varlistentry>
<varlistentry>
<term><ulink url="http://www.oneac.com/home.asp">Oneac</ulink></term>
<listitem><para>
	Oneac sells line interactive and online UPS systems with 
	software in the US and UK.  They were acquired by the 
	Chloride Group (see Chloride Power, below) in 1998.
</para></listitem>
</varlistentry>
<varlistentry>
<term><ulink url="http://www.opti-ups.com/">OPTI-UPS</ulink></term>
<listitem><para>
	OPTI-UPS makes standby, line-interactive, and online UPS 
	systems ranging from 375 VA to 8000 VA.
</para></listitem>
</varlistentry>
<varlistentry>
<term><ulink url="http://www.philtek.com/">Philtek</ulink></term>
<listitem><para>
	Philtek makes inverters and other similar power system 
	components.
</para></listitem>
</varlistentry>
<varlistentry>
<term><ulink url="http://www.waber.com/">SL Waber</ulink></term>
<listitem><para>
	SL Waber sells mostly UPS systems including the Tripp Lite
	brand name as well as a wide assortment of surge suppression 
	and other power accessories.
</para></listitem>
</varlistentry>
<varlistentry>
<term><ulink url="http://www.toshiba.com/">Toshiba</ulink></term>
<listitem><para>
	Toshiba sells a lot of things, including UPSes.  They sell 
	online UPSes from 1400 VA to the 300 kVA range.  One of
	Toshiba's product lines are UPSes specially designed to
	automatically configure themselves to work with both US 
	(60 Hz) and European (50 Hz) power.  
</para></listitem>
</varlistentry>
<varlistentry>
<term><ulink url="http://www.p3international.com/">P3 International</ulink></term>
<listitem><para>
	P3 International makes a number of cool consumer electronics
	devices, but as far as this document is concerned, the
	most interesting is an easy-to-use and relatively 
	inexpensive power monitoring device called "Kill A Watt".
	When you can't or don't want to use a good break-out cable 
	and ammeter, this device is a good choice for measuring 
	power consumption.
</para></listitem>
</varlistentry>
<varlistentry>
<term><ulink url="http://www.power-innovations.com/">Power Innovations International, Inc.</ulink></term>
<listitem><para>
	Power Innovations sells online UPS systems ranging from 
	500 VA to 400 kVA.
</para></listitem>
</varlistentry>
<varlistentry>
<term><ulink url="http://www.chloridepower.com/">Chloride Power</ulink></term>
<listitem><para>
	Chloride Power is a relative newcomer to the U.S. market
	but has much more experience and is better known in Europe.
	For the US market Chloride produces online UPS from the 700 
	VA to 3000 kVA range, and what look like they might be 
	standby systems from 300 VA to 650 VA.  
</para></listitem>
</varlistentry>
</variablelist>

<para>There are a lot of companies in this space, and there's no way that
we can list all of them. We try to include most of the best known companies
along with a few niche players that might be of interest to the readers of
this document. Let me know if there are important companies that we haven't
included.</para>
</sect1>

<sect1><title>Bibliography</title>

<para>One critical source of information on power protection is the IEEE
"color book" series, especially the following:</para>

<itemizedlist>
   <listitem><para>The Emerald Book, IEEE Recommeded Practice for Powering and Grounding Electronic Equipment, Std. 1100-1999, 1999.</para></listitem>
   <listitem><para>The Gold Book, IEEE Recommended Practice for the Design of Reliable Industrial and Commercial Power Systems, Std. 493-1997, 1997.</para></listitem>
   <listitem><para>The Green Book, IEEE Recommended Practice for Grounding of Industrial and Commercial Power Systems, Std. 241-1990, 1990.</para></listitem>
</itemizedlist>

</sect1>
<sect1><title>Acknowledgements and Related Resources</title>

<para>Substantial portions of this document, notably the bits on
maintaining your UPS, were originally part of the
<application>apcupsd</application> documentation. The project
maintainers have graciously permitted me to re-use them here.  Other
parts were part of my <ulink url='&howto;/Unix-Hardware-Buyer-HOWTO/'>Unix
Hardware Buyer HOWTO</ulink>.</para>

<para>There was a previous UPS HOWTO by Harvey J. Stein, last updated
in 1997.  It was so out of date that I ended up using none of it.</para>
</sect1>
</article>

<!--
The following sets edit modes for GNU EMACS
Local Variables:
fill-column:75
compile-command: "mail -s \"UPS HOWTO update\" submit@en.tldp.org <UPS-HOWTO.xml"
End:
End:
-->
